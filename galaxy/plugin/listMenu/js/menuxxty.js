var menu=function(){var e=$.getHelper("provider:menu").cache(),t=!1,n={key:"p_menu",isActive:!1,type:$.page.type,currentMenu:$.page.currentMenu,shadowItem:1,isBuyBtnleave:!1,isBuy:!1,first:{pre:"f_li",firstIndex:0,focus:"f_li0",size:6,height:150},second:{pre:"s_li",firstIndex:0,focus:"s_li0",size:"XXTY"===$.page.type?7:6,height:"XXTY"===$.page.type?132:150},nowInfo:{type:void 0}},s=e[n.type].father;function i(){$('<div class="menu"><div class="shadow"></div>'+(s?'<div class="arrow"></div>':"")+'<div class="logo"></div><div class="menuLine"></div><div class="secondClass "></div><div class="firstClass "></div></div>').appendTo($("#content"))}function r(){a(e[n.type].subList),function(){var t=e[n.type].father;if(!t)return void $(".menu").addClass("simpleList");/^TTXB/.test(n.type)&&$("<div class='logo ttxb'><div>").appendTo($("body"));$('<ul id ="firstContent"></ul>').appendTo($(".firstClass"));var s=[];$.UTIL.each(t,function(e,t){s.push('<li id="f_li'+t+'" class="autoText" index="'+t+'" name="'+e+'">'+e+"</li>")}),$(s.join("")).appendTo($("#firstContent"));var i=t.indexOf(e[n.type].name);if(-1===i)return;i-n.first.firstIndex>=n.first.size-1&&(n.first.firstIndex=i-n.first.size+1+n.shadowItem);$("#firstContent").css("-webkit-transform","translateY("+n.first.firstIndex*-n.first.height+"px)")}()}function a(t){/^TTXB/.test(n.type)&&$(".menu .logo").html(e[n.type].name),$(".secondClass").html(""),$('<ul id ="secondContent"></ul>').appendTo($(".secondClass"));var i=[];$.UTIL.each(t,function(e,t){i.push('<li id="s_li'+t+'" class="autoText" index="'+t+'">'+e.name+"</li>")}),s||(function(){if(e[n.type].bg){var t=$("#content");t.css("background",'url("'+e[n.type].bg+'") no-repeat top right')}}(),function(){if(e[n.type].logo){var t=$("#content .menu .logo");t.css("backgroundImage",'url("'+e[n.type].logo+'")')}}());var r=y();if(r){if(r=+r,e[n.type].subList[0]&&"order"===e[n.type].subList[0].key){var a=[],o=e[n.type].subList[0].id.split(",");for(var u in o)a.push({chargeId:o[u]});c=n.type,$.auth.auth4Pkg({entrance:c,package:a,callback:function(e){if(n.type===c)if(e&&"timeOut"===e.code)n.isBuy=!0;else{n.isBuy=!1;for(var t=0;t<a.length;t++)e[a[t].chargeId]&&(n.isBuy=!0);n.isBuy?$("#"+n.second.pre+0).html("已订购"):$("#"+n.second.pre+0).html("立即订购")}}})}var c;r-n.second.firstIndex>=n.second.size-1&&(n.second.firstIndex=r-n.second.size+1+n.shadowItem),$("#secondContent").css("-webkit-transform","translateY("+n.second.firstIndex*-n.second.height+"px)"),$("#secondContent").html(i.join(""))}else $("#secondContent").html(i.join(""))}$.addBackUrlRedefine(function(e){var t=B();return $.search.append(location.href,{type:t.type,currentMenu:t.currentMenu,POSITIVE:null})});var o=function(){if($.pTool.active("p_menu"),t)t=!1;else{var e=n.isBuyBtnleave?0:y(),s=e?"#s_li"+e:"#s_li0";$.focusTo({el:s,marquee:[s+".autoText"]}),n.isBuyBtnleave=!1}},u=function(){n.isActive=!1};function c(){var t=y(),s=e[n.type],i=s.subList[t].id;return{style:s.subList[t].pageType,id:i,type:s.className[1],menuType:n.type,menuCurrent:n.currentMenu,bg:s.bg||"",vodBg:s.vodBg||""}}function d(e){$("#content").hasClass("contentMoveR")?$("#content")[0].className="style"+e.style+" "+e.type+" contentMoveR":$("#content")[0].className="style"+e.style+" "+e.type}var f,l,p,v=(f=function(t){!function(t){if(n.type===n.nowInfo.type&&n.currentMenu===e[n.type].subList[t].key)return void $("#"+n.second.pre+y()).addClass("current");n.nowInfo.type=n.type,n.currentMenu=e[n.type].subList[t].key;var s=c();n.updateCallBack&&n.updateCallBack(s),$.isBackRedefine(!1),d(s)}(t)},l=800,function(e){var t=this;clearTimeout(p),p=setTimeout(function(){f.apply(t,[e])},l)});function y(){var t=e[n.type].subList,s=$.UTIL.lookupIndex(t,n.currentMenu,"key");return-1===s?null:s}function m(){$("#content").hasClass("contentMoveR")?($(".menu .menuLine").show(),$(".menu .arrow").hide()):($(".menu .menuLine").hide(),$(".menu .arrow").show(),$(".menu .arrow").addClass("pulse"))}function h(){n.second.focus="s_li0",n.second.firstIndex=0,n.currentMenu=e[n.type].subList[0].key,$("#secondContent").css("-webkit-transform","translateY(0px)")}function x(){for(var t=0;t<e[n.type].subList.length;t++)$("#"+n.second.pre+t).removeClass("current");$("#"+n.second.pre+y()).addClass("current")}var g=function(){var i=function(){return $($.activeObj.el)[0].parentNode},r=function(){return $($.activeObj.el).attr("index")},c=function(){return $.activeObj.el};return{key:"p_menu",keysMap:{KEY_DOWN:function(){var t=+r(),s=$("#s_li"+t);if(t>=i().children.length-1)return!0;t++;var o=c().replace(/\d+$/,t);$.focusTo({el:o,marquee:[o+".autoText"]}),"XXTY"==n.type&&s.removeClass("current");var u=/first/.test(i().id)?n.first.firstIndex:n.second.firstIndex,d=/first/.test(i().id)?n.first.size:n.second.size,f=/first/.test(i().id)?n.first.height:n.second.height;if(t-u>=d-n.shadowItem&&(u++,/first/.test(i().id)&&n.first.firstIndex++,/second/.test(i().id)&&n.second.firstIndex++,$(i()).css("-webkit-transform","translateY("+u*-f+"px)")),/first/.test(i().id)){var l=null,p=$(o).attr("name");for(var y in e)e[y].name===p&&(l=e[y].subList,n.type=y);l&&a(l),h(),v(0)}else v(t);return!0},KEY_UP:function(){var t=+r(),s=$("#s_li"+t);if(t<=0)return/second/.test(i().id)&&(/current/.test($($.activeObj.el)[0].className)||b())&&(b()&&(n.isBuyBtnleave=!0),n.up&&n.up()),!0;var o=/first/.test(i().id)?n.first.firstIndex:n.second.firstIndex,u=/first/.test(i().id)?n.first.height:n.second.height;if(t===o&&(o--,/first/.test(i().id)&&n.first.firstIndex--,/second/.test(i().id)&&n.second.firstIndex--,$(i()).css("-webkit-transform","translateY("+o*-u+"px)")),b(""+--t)&&1!==y())return!0;var d=c().replace(/\d+/,t);if($.focusTo({el:d,marquee:[d+".autoText"]}),"XXTY"==n.type&&s.removeClass("current"),/first/.test(i().id)){var f=null,l=$(d).attr("name");for(var p in e)e[p].name===l&&(f=e[p].subList,n.type=p);f&&a(f),h(),v(0)}else b()||v(t);return!0},KEY_LEFT:function(){if(!s)return!0;var t=i().id;if(/second/.test(t)){if($("#content").addClass("contentMoveR"),n.second.focus=c().replace("#",""),!e[n.type].father)return;var r=e[n.type].father.indexOf(e[n.type].name);if(-1===r)return!0;$.focusTo({el:"#f_li"+r,marquee:["#f_li"+r+".autoText"]}),r-n.first.firstIndex>=n.first.size&&(n.first.firstIndex=r-n.first.size+2,$(i()).css("-webkit-transform","translateY("+n.first.firstIndex*-n.first.height+"px)")),$("#video").addClass("noPlayer"),n.move&&n.move()}return m(),x(),!0},KEY_RIGHT:function(){var e=$(i()).attr("id");if(/second/.test(e)){if(r()!=y()&&!b())return;n.right&&n.right()}else{$("#content").removeClass("contentMoveR"),n.first.focus=c();var t=y()||0,s="#"+n.second.pre+t;$.focusTo({el:s,marquee:[s+".autoText"]}),n.move&&n.move(),m()}return!0},KEY_OK:function(){return b()&&!n.isBuy&&(n.isBuyBtnleave=!0,$.auth.forwardOrder(!1,!1,[e[n.type].subList[$($.activeObj.el).attr("index")].id])),!0}},active:o,deactive:u,blur:T,cover:function(){return!0},uncover:function(){return t=!0,!0}}};function I(e){n.right=e.right||function(){},n.up=e.up||function(){},n.updateCallBack=e.updateCallBack,n.first.firstIndex=e.first||n.first.firstIndex,n.second.firstIndex=e.second||n.second.firstIndex,n.move=e.move||function(){},n.isBuyBtnleave=e.isBuyBtnleave||!1}function b(t){var s=e[n.type].subList[t||$($.activeObj.el).attr("index")];return s&&s.index<0&&"order"===s.key}function T(){n.isActive=!1;var e=y();$("#s_li"+e).addClass("current")}function B(){return{type:n.type,currentMenu:n.currentMenu,first:n.first.firstIndex,second:n.second.firstIndex,isActive:n.isActive,isBuyBtnleave:n.isBuyBtnleave}}return{init:function(e){return $.pTool.add(n.key,g()),I(e),i(),r(),d(c()),c()},active:o,renderContent:i,renderList:r,getCurrentName:function(){var t=y()||0;return e[n.type].subList[t].name},initMenuInfo:I,blur:T,getState:B,addCur:x,addTransition:function(){$("#content").css("-webkit-transition","all 0.6s ease 0s")}}}();