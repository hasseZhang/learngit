var lastType,name="provider:menu",nameVan="provider:menu.van",lg=Logger,topic=new $.Topic,last=getExptCache(name);function lastTypeNeedRestart(){return("repeat"===lastType||"begin"===lastType)&&lastType}function callback(e){lg.debug("callback",name),dealData(name,e,noChange,hasChange,callbackErr)}function complete(){lg.debug("complete",name),topic.pub("complete",cache())}function noChange(e){lg.debug("noChange",name),topic.pub("none",cache())}function hasChange(e,a){lg.debug("hasChange",name),cacheData=null,topic.pub("change",e,cache())}function callbackErr(){Logger.out.error=["%s fetch error",name],topic.pub("error")}function loadData(e){if(e){e=e.replace(/{|-| |:|}/g,"");var a=getFileInfoData(nameVan);if(a&&e<=a)return complete();$.get($.urls.dataMenu,{success:function(e,a){callback(a),setFileInfo(nameVan,"",e,0)}.bind(null,e),error:callbackErr,complete:complete,timeout:3e3})}}last&&last.topic&&(topic._NS_Topic_once=last.topic._NS_Topic_once,topic._NS_topic=last.topic._NS_topic),last&&last.data&&(lastType=last.data.type,lastTypeNeedRestart()?last.data.clear():lastType=null),last=null;var cacheData,data=$.Timer(function(){lg.debug("fetchVanData",name),$.get($.urls.dataVanMenu,{success:loadData,error:callbackErr,timeout:800})},18e5);function getKanbaSubList(e,a){var t=[],n=/^order@/.test(a&&a[0]&&a[0].contentUrl);return each(a,function(a,c){var r=(a.contentUrl||"").split("@"),o=r[0],l=r[1],i=r[2],p=$.search.append("listPage/",{type:e,currentMenu:l});t.push({key:l,id:i,name:a.contentName,pageType:o,path:p,type:e,index:n?c-1:c})}),t}function cache(){if(cacheData)return sclone(cacheData);var e=sclone(getFileInfoData(name));if(e){var a={};return each(e,function(e,t){e.father&&(a[e.father]||(a[e.father]=[]),a[e.father][e.order]=e.name,delete e.order),e.subListOrign&&(e.subList=getKanbaSubList(t,e.subListOrign),delete e.subListOrign)}),each(e,function(e,t){e.father&&(e.father=a[e.father])}),cacheData=e,e=a=null,sclone(cacheData)}}function padding(e){if($.UTIL.isFunction(e))return topic.once("complete",e),data.now().repeat(),!0}cache.get=function(e,a){e=(""+e).toUpperCase();var t,n=cacheData[e];if(n)return UTIL.isString(a)||UTIL.isNumber(a)?each(n.subList,function(e){if(e.key==a||e.index==a)return t=sclone(e),!0}):t=sclone(n),t},lastTypeNeedRestart()&&data[lastTypeNeedRestart()](),expt.rev=1,expt.expire=0,expt.padding=padding,expt.data=data,expt.cache=cache,expt.topic=topic;