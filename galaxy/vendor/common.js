function ready(e,t){t.body?setTimeout(e,0):t.addEventListener("DOMContentLoaded",function(){t.removeEventListener("DOMContentLoaded",arguments.callee,!1),e()},!1)}var getFTPFilePath=function(){function e(e){return parseInt(e,10)+48}return function(t,i){for(var n=[],r="",o=t.length;0<o;o-=4)n.push(t.substring(4<o?o-4:0,o));var s=function(t){for(var i="",n=1,r=t.length-7<=0?0:t.length-8;r<t.length;r++)n*=e(t.charAt(r))%9+1;for(r=1;r<t.length;r++)i+=(o=t.charAt(r),s=(e(t.charAt(r-1))%9+r)*n*r,a=void 0,a=e(o)+s,(a%=122)<65&&(a+=65),122<a&&(a=122-a%122),90<a&&a<97&&(a=s%2==0?90-a%90:97+a%90),{65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",97:"a",98:"b",99:"c",100:"d",101:"e",102:"f",103:"g",104:"h",105:"i",106:"j",107:"k",108:"l",109:"m",110:"n",111:"o",112:"p",113:"q",114:"r",115:"s",116:"t",117:"u",118:"v",119:"w",120:"x",121:"y",122:"z"}[a]);var o,s,a;return i}(t);for(o=n.length-1;0<o;o--)r+=n[o]+"/";return r+s+n[0]+"."+i}}(),UTIL=tima&&tima.UTIL||{},EPG=tima&&tima.EPG||{},Date2=tima&&tima.Date||Date,String2=tima&&tima.String,variable=EPG.profiles,slice=UTIL.slice,each=UTIL.each,apply=UTIL.apply,merge=UTIL.merge,sclone=UTIL.sclone,__localStorage={};function setItem(e,t,i){__localStorage[e]||(__localStorage[e]={}),__localStorage[e][t]=i}function getItem(e,t){return __localStorage[e]&&__localStorage[e][t]||void 0}function removeItem(e,t){"*"===t?delete __localStorage[e]:__localStorage[e]&&delete __localStorage[e][t]}function getVariable(e){return/^EPG:/.test(e)?EPG[e.replace("EPG:","")]:apply(variable&&variable.get,[e])}function getHelper(e){return EPG.helper[e]}function Search(e,t){return{get:function(e,i){var n=(i||t.location.search||"").replace(/[^?]*\?/,"");if(e&&"*"!==e){var r=new RegExp("(^|&)"+e+"(?:=([^&]*))*(&|$)","i"),o=n.match(r);return o&&parse(o[2])}var s={};return n&&each(n.split("&"),function(e){var t=e.split("=");t[0]&&(s[t[0]]=parse(t[1]))}),s},toUrl:function(e){var t=[];return each(e,function(e,i){void 0===e||""===e?t.push(i):null!==e&&t.push(i+"="+e)}),t.join("&")},append:function(e,i){var n=e||t.location.href,r=this.get("",n.split("?")[1]||"?"),o=i;"string"!=typeof i&&"number"!=typeof i||(o=this.get("",""+i)),each(o,function(e,t){r[t]=e});var s=this.toUrl(r);return n.replace(/\?.*$|$/,s?"?"+s:"")}}}function parse(e){return"null"===e?e=null:"undefined"===e?e=void 0:"true"===e?e=!0:"false"===e&&(e=!1),e}function getTokens(){return window.cwindow&&window.cwindow.$&&window.cwindow.$.tokens}function ajax(e){if((e=e||{}).loading&&e.loading(),e.method=e.method&&e.method.toUpperCase()||"GET",e.url=e.url||"",e.async=!!UTIL.isUndefined(e.async)||e.async,e.cache=!UTIL.isUndefined(e.cache)&&e.cache,e.data=e.data||null,"POST"===e.method&&!e.data&&/#/.test(e.url)){var t=e.url.split("#");if(t[1])try{for(var i={},n=t[1].split("&"),r=0;r<n.length;r++){var o=n[r].split("=");i[o[0]]=o[1]}e.data=JSON.stringify(i)}catch(t){}e.url=t[0]}var s=e&&e.timeout||3e3,a=new XMLHttpRequest;a.tokens=getTokens(),a.open(e.method,e.url,e.async),e.cache||a.setRequestHeader("Cache-Control","no-cache"),"POST"===e.method&&a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){if(e&&a){if(a.tokens&&a.tokens!==getTokens())return a.timeoutTimer&&clearTimeout(a.timeoutTimer),e=a.onreadystatechange=null,a.abort(),void(a=null);if(a&&4==a.readyState){e.async&&clearTimeout(a.timeoutTimer);var t="";200<=a.status&&a.status<300||304==a.status?(t=a.responseText,e.success&&e.success(t)):(t=new Error("ajax error, code is "+a.status+", url is "+e.url),e.error&&e.error(t)),e.complete&&e.complete(t),t=a.onreadystatechange=a=e=null}}},e.async&&(a.timeoutTimer=setTimeout(function(){a&&a.abort()},s)),a.send(e.data)}function get(e,t,i){return ajax(merge({url:e,async:i},t,{method:"GET"}))}function post(e,t,i){return ajax(merge({url:e,async:i},t,{method:"POST"}))}function Timer(e,t){if(!(this instanceof Timer))return new Timer(e,t);var i={fn:e,delay:t||100};return{begin:function(e){return this.clear(),this._timer=setTimeout(i.fn,e||i.delay),this.type="begin",this},clear:function(){return this._timer&&(clearTimeout(this._timer),this._timer=null),delete this.type,this},now:function(){return this.clear(),apply(i.fn),this.type="now",this},repeat:function(e){return this.clear(),this._timer=setInterval(i.fn,e||i.delay),this.type="repeat",this}}}function Tpl(e){function t(e){return{ds:e,type:-1<e.length?1:0,index:0}}function i(e){return this.tpl=e.replace(/^\s*|\s*$/gm,"").replace(/[\r\n]+/gm,""),this}return i.prototype={constructor:i,compile:function(e,i){var n=function(e,i){return this.data=e,this.unencode=i,this.scopes=[t(e)],this.tpl.replace(/{{(#each.+?)}}(.*?)(?={{\/each}})|{{([^}]+?)}}/g,function e(i,n,r,o){var s="",a=n&&n.replace(/ .*$/,"")||o,l=n&&n.replace(a+" ","")||o,c=this.scopes[this.scopes.length-1];switch(a){case"#each":var u="this"===l?c.ds:c.ds[l],d=t(u);for(var h in d.type=1,this.scopes.push(d),u)u.hasOwnProperty(h)&&(this.scopes[this.scopes.length-1].index=h,s+=r.replace(/{{([^}]+?)}}/g,e.bind(this)));break;case"/each":this.scopes.pop();break;default:var p=c.ds;1===c.type&&(p=p[c.index]),"this"===l&&p+""||p[l],s=function(e,t){var i,n,r="";switch(e.key){case"this":r=e.ds;break;case"index":r=e.index;break;default:r=t?e.ds.hasOwnProperty(e.key)?e.ds[e.key]:"{{"+e.key+"}}":(i=e.ds[e.key]||"",n={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},(i+"").replace(/[&"'<>\/]/g,function(e){return n[e]}))}return r}({key:l,index:c.index,ds:p},this.unencode)}return s}.bind(this))}.call(this,e,i);return delete this.data,delete this.scopes,n},render:function(e,t,i){$(e).html(this.compile(t,i))}},new i(e)}function Tps(e){if(UTIL.isString(e))return apply(String2.prototype.format,arguments)}function Services(e,t){return EPG.initServices(ajax,e,t)}function Marquee(e){var t=function(e){e.height=e.height||"99%",e.width=e.width||"98%",e.el.innerHTML='<marquee width="'+e.width+'" height="'+e.height+'" scrollamount="4">'+e.all+"</marquee>"};if(this instanceof Marquee){var i=this;return function(e){var n=e&&e.el,r=i.last;r&&n&&Query.isEqualNode(e.el,r.el)&&/\<marquee[^>]*>/.test(r.el.innerHTML)||(r&&(r.el&&""!==r.el.innerHTML&&/\<marquee[^>]*>/.test(r.el.innerHTML)&&(r.el.innerHTML=r.text||""),i.last=null),n&&(i.last={el:e.el,text:e.short||e.el.innerText||e.el.textContent||e.el.innerHTML},t(e)))}}var n=e&&e.el;Marquee.last&&n&&Query.isEqualNode(e.el,Marquee.last.el)&&/\<marquee[^>]*>/.test(Marquee.last.el.innerHTML)||(Marquee.last&&(Marquee.last.el&&""!==Marquee.last.el.innerHTML&&/\<marquee[^>]*>/.test(Marquee.last.el.innerHTML)&&(Marquee.last.el.innerHTML=Marquee.last.text||""),Marquee.last=null),n&&(Marquee.last={el:e.el,text:e.short||e.el.innerText||e.el.textContent||e.el.innerHTML},t(e)))}function Marquee2(e){function t(e,t){e&&e.style&&(e.style.webkitAnimation=t)}var i=function(e,i){var n=i.el.innerHTML,r=i.el.clientWidth,o=window.getComputedStyle(i.el),s=o.textIndent;i.el.innerHTML="";var a=document.createElement("m");a.style.display="block",a.innerHTML=n,a.style.display="-webkit-inline-box",a.style.width="fit-content",a.style.minWidth=r+"px",a.style.textAlign=o.textAlign,a.style.textIndent=s,i.el.appendChild(a);var l=i.speed||40,c=a.offsetWidth,u=i.animate||"marquee infinite linear normal";r<c?e.timer=setTimeout(t,Math.min(r/200*1e3,3e3),a,c/l+"s "+u):i.el.innerHTML=n,a=null};if(this instanceof Marquee2){var n=this;return function(e){var t=e&&e.el,r=n.last;r&&t&&Query.isEqualNode(e.el,r.el)&&/\<m[^>]*>/.test(r.el.innerHTML)||(r&&(r.el&&""!==r.el.innerHTML&&/\<m[^>]*>/.test(r.el.innerHTML)&&(r.el.innerHTML=r.text||""),clearTimeout(n.timer),n.timer=n.last=null),t&&(n.last={el:e.el,text:e.short||e.el.innerText||e.el.textContent||e.el.innerHTML},apply(i,[n,e])))}}var r=e&&e.el;Marquee2.last&&r&&Query.isEqualNode(e.el,Marquee2.last.el)&&/\<m[^>]*>/.test(Marquee2.last.el.innerHTML)||(Marquee2.last&&(Marquee2.last.el&&""!==Marquee2.last.el.innerHTML&&/\<m[^>]*>/.test(Marquee2.last.el.innerHTML)&&(Marquee2.last.el.innerHTML=Marquee2.last.text||""),clearTimeout(Marquee2.timer),Marquee2.timer=Marquee2.last=null),r&&(Marquee2.last={el:e.el,text:e.short||e.el.innerText||e.el.textContent||e.el.innerHTML},apply(i,[Marquee2,e])))}Date2.prototype.format=function(e){!e&&(e="yyyy-MM-dd hh:mm:ss");var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3)};return/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").slice(-RegExp.$1.length))),/(W)/.test(e)&&(e=e.replace(RegExp.$1,["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][this.getDay()])),/(S+)/.test(e)&&(e=e.replace(RegExp.$1,("00"+this.getMilliseconds()).slice(-3).slice(0,RegExp.$1.length))),each(t,function(t,i){new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,("00"+t).slice(-RegExp.$1.length)))}),e},Date2.prototype.toGmt=function(){return this.isGmt||(this.isGmt=!0,this.setMinutes(this.getMinutes()+this.getTimezoneOffset())),this},Date2.prototype.toLoc=function(){return this.isGmt&&(delete this.isGmt,this.setMinutes(this.getMinutes()-this.getTimezoneOffset())),this},Date2.prototype.parse=function(e,t,i){function n(e,t){var i=String.prototype.match.call(e,t);if(i){var n=i.index;return[n,n+i[0].length]}}!t&&(t="yyyyMMddhhmmss");var r=n(t,"y+"),o=n(t,"M+"),s=n(t,"d+"),a=n(t,"h+"),l=n(t,"m+"),c=n(t,"s+"),u=n(t,"S+"),d=r&&e.substring(r[0],r[1])||"0",h=o&&e.substring(o[0],o[1])-1,p=s&&e.substring(s[0],s[1]),f=a&&e.substring(a[0],a[1]),_=l&&e.substring(l[0],l[1]),g=c&&e.substring(c[0],c[1]),y=u&&e.substring(u[0],u[1]);return 4==d.length?this.setFullYear(d):this.setYear(d),this.setMonth(h||0),this.setDate(p||0),this.setHours(f||0),this.setMinutes(_||0),this.setSeconds(g||0),this.setMilliseconds(y%1e3||0),i&&(this.isGmt=!!i),this},function(e){function t(e,t,i){t||(t="def");var n=i?e._NS_Topic_once:e._NS_topic;return n&&n[t]||void 0}function i(){}i.prototype={constructor:i,pub:function(e){var i=UTIL.slice(arguments,1);setTimeout(function(e,i,n){UTIL.each(t(i,e),function(e){UTIL.apply(e,n)});var r,o,s=t(i,e,!0);UTIL.each(s,function(e){UTIL.apply(e,n)}),s&&(o=e,(r=i)._NS_Topic_once&&r._NS_Topic_once[o]&&delete r._NS_Topic_once[o]),e=n=null},0,e,this,i),e=i=null},sub:function(e,i,n){var r=t(this,e,n);-1==UTIL.lookupIndex(r,i)&&function(e,t,i,n){t||(t="def");var r=i?e._NS_Topic_once:e._NS_topic;r||(r=i?e._NS_Topic_once={}:e._NS_topic={}),r[t]||(r[t]=[]),r[t].push(n)}(this,e,n,i)},once:function(e,t){this.sub(e,t,!0)},rm:function(e,i,n){var r=t(this,e,n),o=UTIL.lookupIndex(r,i);-1<o&&r.splice(o,1)},rmOnce:function(e,t){this.rm(e,t,!0)},empty:function(){var e;(e=this)._NS_topic&&delete e._NS_topic,e._NS_Topic_once&&delete e._NS_Topic_once}},e.Topic=i}(window),function(e){var t,i,n,r,o={},s={};function a(e){c();var t={};return i.apply(t,[e]),t}function l(e,t,i,r){var o=[t,i,r],s=n(e[t],o,e);if(!s&&r)for(var a=r.length;0<=a&&!(s=n(e[r[a]],o,e));a--);return s}function c(){t||(t=!0,i=UTIL.extend,n=UTIL.apply,r=UTIL.slice)}var u={keyRes:function(e){c();try{var t=r(arguments);t.unshift(o);var i=n(l,t);return i||(t.shift(),t.unshift(s),i=n(l,t)),i}catch(e){Logger.out.error=["%c%s \n\t%s","color:red;font-style:italic;",e.message,e.stack&&e.stack.match(/at.*/)&&e.stack.match(/at.*/)[0]]}},setRes:function(e){o=a(e)},setDftRes:function(e){s=a(e)},reset:function(){this.setRes({}),this.setDftRes({})}};window.keyTool=u}(window),function(e){var t,i,n,r,o,s,a,l=[],c={demoPlugin:{key:"demoPlugin",dft:0,keysMap:{KEY_0:Function},keysDftMap:[],init:Function,active:Function,deactive:Function,cover:Function,uncover:Function,destroy:Function}},u={};function d(e,s,a){t||(t=!0,n=(i=UTIL).extend,r=i.apply,o=i.each,i.slice),e[s]=a}function h(e,t){delete e[t]}function p(){var e={};return o(u,function(t){var i={};o(t.keysDftMap,function(e){i[e]=t.keysMap[e]}),n.apply(e,[i])}),e}function f(){if(s){var e=s;_(),r(e&&e.deactive,null,e),e=null}}function _(){s=void 0,keyTool.setRes({})}var g={add:function(e,t){d(c,e,t),t.dft&&(d(u,e,t),keyTool.setDftRes(p()))},get:function(e){return c[e]},active:function(e){if(s&&s.key===e)return e;var t=this.get(e);if(t){var i=s;return i&&(t&&"weak"===t.type?"weak"!==i.type&&(a=i):("weak"===i.type&&(f(),i=a,a=null),r(i&&i.cover,null,i)&&l.push(i)),f()),s=t,t=null,s?(r(s.active,null,s),keyTool.setRes(s.keysMap),e):void 0}},deactive:function(e){var t=!1;e&&s&&s.key===e&&(t=!0),!e&&s&&(t=!0),t&&(f(),function(){if(a&&(l.push(a),a=null),l.length){var e=l.length;o(l,function(t,i){if(r(t.uncover,null,t))return e=i,!0},0,1);var t=l.splice(e)[0];t&&g.active(t.key)}}())},rm:function(e){var t=this.get(e);t&&(this.deactive(e),r(t.destroy,null,t),t.dft&&(h(u,e),keyTool.setDftRes(p())),o(l,function(t,i){if(t.key===e)return l.splice(i,1)}),h(c,e))},reset:function(){_(),l=[],c={},u={},a=null},toString:function(){return{actived:s,list:c,listDft:u,covered:l,uncovered:a}}};e.pTool=g}(window);var MP={},SERVICES={},VS=initVS(getVariable("common.dc")),commonProto={getGlobalData:function(e){var t=getItem("cwindow",e);if(null!==t&&"null"!==t&&void 0!==t&&"undefined"!==t&&""!==t)return sclone(t)},saveGlobalData:function(e,t){void 0===t?removeItem("cwindow",e):setItem("cwindow",e,sclone(t))},saveBackUrl:function(e,t,i){var n="G_BACK_URL_LIST",r=this.getGlobalData(n)||[],o=this.search.append(e,{POSITIVE:null});if(i&&(o=i(o)),o&&r.push(o),t)for(var s=t.split("?")[0],a=0;a<r.length;a++)if(s===r[a].split("?")[0]){r.splice(a);break}this.saveGlobalData(n,r)},getBackUrl:function(e){var t="",i="G_BACK_URL_LIST",n=this.getGlobalData(i)||[];return n.length&&(t=n.pop(),e&&this.saveGlobalData(i,n)),t},emptyBackUrl:function(){this.saveGlobalData("G_BACK_URL_LIST",[])}};function initVS(e){return{url:e,userId:EPG.userId,stbId:EPG.stbId,node:EPG.node,first:!Authentication.CTCGetConfig("firstBoot"),firstBoot:function(){return!!this.first&&(this.first=!1,Authentication.CTCSetConfig("firstBoot","2"),this.send({analysistype:"login",mac:EPG.mac,stbModel:EPG.STBType,areaid:EPG.areaId||""}),!0)},vodPlayBegin:function(e){var t={vodid:e.contentId,times:e.duration,vodname:e.name,colid:e.categoryId,chargeSpIds:e.chargeSpIds||"",analysistype:"vodbegin",groupId:e.groupId||"",playModel:e.playModel||""};e.deferred&&(t.deferred=!0),e.mini&&(t.mini=!0),this.send(t)},vodPlay:function(e,t,i,n,r){this.vodPlayBegin({contentId:e,duration:t,name:i,categoryId:n,chargeSpIds:r})},vodSizePlay:function(e,t,i,n,r){this.vodPlayBegin({contentId:e,duration:t,name:i,categoryId:n,chargeSpIds:r,playModel:"small",deferred:!0,mini:!0})},serialPlayBegin:function(e){this.send({vodid:e.contentId,times:e.duration,vodname:e.name,colid:e.categoryId,chargeSpIds:e.chargeSpIds||"",analysistype:"vodseriesbegin",groupId:e.groupId||"",playModel:e.playModel||""})},serialPlay:function(e,t,i,n,r){this.serialPlayBegin({contentId:e,duration:t,name:i,categoryId:n,chargeSpIds:r})},serialSizePlay:function(e,t,i,n,r){this.serialPlayBegin({contentId:e,duration:t,name:i,categoryId:n,chargeSpIds:r,playModel:"small",deferred:!0,mini:!0})},xljPlay:function(e,t,i,n,r){this.vodPlay(e,t,i,n,r)},tvodPlay:function(e,t,i,n){this.send({tvodchno:e,tvodtimes:t,tvodname:i,analysistype:"tvodbegin",tvodbegintime:n})},livePlay:function(e){this.send({channelid:e,analysistype:"channelcontinuebegin"})},liveSizePlay:function(e){this.send({channelid:e,analysistype:"channelcontinuebegin",deferred:!0,mini:!0})},liveContinue:function(){this.send({analysistype:"channelstate"})},playQuit:function(e){this.send({analysistype:"playEnd",quittype:e||"osd"},!0)},page:function(e,t,i){this.send({analysistype:"access",referpage:e,refer:!0,columnid:i||"",url:t})},invented:function(){this.send({analysistype:"invented"})},zt:function(e){this.send({analysistype:"zt",spName:e})},product:function(e,t,i,n,r){var o={analysistype:"product",productMode:r,productid:e,sourcetype:i||"",referpage:n||window.referrer&&referrer.split("?")[0]||"",state:t};this.send(o)},link:function(e){this.event(e?"success":"failure","01")},homeTj:function(e,t){this.event(e,"05",t)},event:function(e,t,i){this.send({analysistype:"event",ignore:"adnamepathid",eventcode:t,eventdata:e},i)},getDcBaseInfo:function(){return{userid:this.userId,stbid:this.stbId,stbtype:"huawei"==this.node?2:1,processtype:"MapInfoProcess",version:2,time:(new $.Date).format("yyyyMMddhhmmss")}},send:function(e,t){var i=e.deferred,n=e.mini;if(this.firstBoot())this.lastReferpage=e.referpage;else if(!this.lastReferpage||!i){if(this.lastReferpage&&delete this.lastReferpage,clearTimeout(this.deferredTimer),i)return delete e.deferred,void(this.deferredTimer=setTimeout((r=e,o=t,s=this,function(){s.send(r,o)}),2e3));var r,o,s;n&&delete e.mini,this.frameQuitFlag&&(t=!0);var a=$.search.append(this.url,$.UTIL.merge(this.getDcBaseInfo(),e)),l=$.UTIL.owns({vodbegin:1,vodseriesbegin:1,tvodbegin:1,channelcontinuebegin:1,channelstate:1},e.analysistype);if(!n&&l&&(this.hasPlayBegin=!0),"playEnd"!=e.analysistype||this.frameQuitFlag){var c=!1;"event"==e.analysistype&&n||this.lastPlayOsdUrl&&!l&&(c=!0,this.sendLastPlayOsd()),"invented"!=e.analysistype&&this.sendXhr(a,!t,c)}else this.hasPlayBegin&&(this.lastPlayOsdUrl=a)}},sendLastPlayOsd:function(){this.lastPlayOsdUrl&&(this.sendXhr(this.lastPlayOsdUrl,!1),delete this.hasPlayBegin,delete this.lastPlayOsdUrl)},sendXhr:function(e,t,i){if($.getVariable("EPG:onPc"))return $.log.out.info=["vs",!t,!!this.frameQuitFlag],$.log.out.info=[$.search.get("*",e)],!0;var n=new XMLHttpRequest;n.open("GET",e,!t),i?setTimeout(function(){n.send()},100):n.send()},frameQuit:function(){this.frameQuitFlag=!0,this.sendLastPlayOsd()}}}function PureList(e){e||(e={}),this._={list:e.list||[],current:+e.current,loop:!!e.loop},this._.total=+e.total||this._.list.length}function VideoList(e){apply(PureList,[e],this),delete e.list,this._.pre=sclone(e.pre)||[],delete e.pre,this.cfg=e,this.cfg.onBeforePlay=function(e,t,i,n){e?(this._goon_prevideo=i,apply(e,[t,i,n])):i()}.bind(this,e.onBeforePlay&&e.onBeforePlay.bind(e))}function FetchData(e){var t={},i=e.type,n=-1,r=e.jsonp,o={},s={},a=e.blockSize||100,l="num_",c="task_";function u(e,t){var i=[],r=Math.floor(e/a);r<0&&(r=0);var o=Math.floor((t-1)/a),s=Math.floor(n/a);if(0<=n&&s<o&&(o=s),i.push(r),r!==o)for(var l=1;l<=o-r;l++)i.push(r+l);return i}function d(e){for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if(!t[l+n])return!1}return!0}function h(e,i,n){for(var r=[],o=0;o<n.length;o++){var s=n[o],c=t[l+s];r=r.concat(c.data)}e<0&&(e=0);var u=e%a;return r.slice(u,u+(i-e))}function p(e,t){var n=c+e;s[n]||d([e])||(r(i,e,f,function(e,t){delete s[c+e];var i=this.preload.error;t&&i&&(delete this.preload.error,i(),i=null)}.bind(_,e,t),t),s[n]="loading")}function f(e){n=e.total;var i=Math.floor(e.rangeMin/a);t[l+i]=e;var r=c+i;for(var p in delete s[r],o)if(o.hasOwnProperty(p)){var f=p.split("_"),_=+f[1],g=+f[2],y=u(_,g);if(d(y)){var m=h(_,g,y);"function"==typeof o[p]&&o[p](m,_,g,n),delete o[p]}}}var _={sync:function(e,t){var i=u(e,t),r=Math.ceil(a/2),o=e-r,s=t+r;if(o<0&&(o=0),-1<n&&n<s&&(s=n),this.async(o,s),d(i))return h(e,t,i);throw new Error("data loading begin:"+e+" end:"+t)},async:function(e,t,i,r){var s=u(e,t);if(d(s)){if("function"==typeof i){var a=h(e,t,s);setTimeout(i,50,a,e,t,n)}}else!function(e,t,i,n,r){for(var s in e)e.hasOwnProperty(s)&&p(e[s],r);o["cb_"+t+"_"+i]=n||"fun"}(s,e,t,i,r)},preload:function(e,t,i,r){e<0&&(e=0),t<=e&&(t=e+1);var o,s=Math.ceil(a/2),l=e-s,c=t+s;function u(e){return function(t,i,n,r,o){var s,a,l;e.async(t,i,(s=n,a=r,l=o,function(t,i,n,r){e&&(delete e.preload.error,e=null);var o=s-i,c=(t||[]).slice(o,o+(a-s));"function"==typeof l&&l(c,s,a,r)}),!0),t=i=n=r=o=null}.bind(e)}l<0&&(l=0),-1<n&&n<c&&(c=n),r&&(this.preload.error=r),n<0?(o=u(this),this.async(0,1,function(n,r,s,u){if(u<=e||500==a)return i&&i(null,e,t,u);u<t&&(t=u),u<c&&(c=u),o(l,c,e,t,i)},!0)):i?(o=u(this))(l,c,e,t,i):this.async(l,c)}};return _}function initAnimatePanel(e){var t=document;return e&&(t=e.document),function(e){var i=[];function n(t){e.transition&&t&&t.el&&!t.hasEffect&&(t.hasEffect=!0,t.el.style.webkitTransition=e.transition)}function r(t){e.transition&&t&&t.el&&t.hasEffect&&(t.hasEffect=!1,t.el.style.webkitTransition="none")}function o(e){if(e||(e=1),!(m<=0)){m<e&&(e=m),n(l),n(c);var t=l.check(e);0<t&&u!==c.type+l.type&&c.transfer(t),l.moveCalc(e),c.moveCalc(e),Logger.debug(l.top,c.top),c.top>-(_+p)+y&&(c.transfer(e),Logger.debug("> ",-(_+p)+y)),l.move(),c.move(),m-=e,I(e)}}function s(e){if(e||(e=-1),!(T<=m+_)){n(l),n(c);var t=l.check(e);t<0&&u!==l.type+c.type&&c.transfer(t),l.moveCalc(e),c.moveCalc(e),Logger.debug(l.top,c.top),c.top<-(_+p)&&(l.transfer(e),Logger.debug("< ",-(_+p),l.top,c.top)),l.move(),c.move(),m-=e,I(e)}}function a(i){if(b.top){var o=m-i;Logger.debug(o),b.topIndex-=o,P.topIndex-=o,m=i}else b.top=-(_+p),b.topIndex=m-(_+p),P.top=b.top+y,P.topIndex=b.topIndex+y;!function(i,r){if(!b.el){var o=t.createElement("div");o.className=i||"";var s=t.createElement("div");s.style.cssText=["position:absolute","height:"+y*h+"px","left:0","-webkit-transform:translateY("+b.top*h+"px)","-webkit-transition:"+e.transition,"width:100%","overflow:hidden"].join(";");var a=t.createElement("div");a.className="reflect",a.style.cssText=["position:absolute","height:"+y*h+"px","left:0","width:100%","-webkit-transform:translateY("+P.top*h+"px)","-webkit-transition:"+e.transition,"overflow:hidden"].join(";"),o.appendChild(s),o.appendChild(a),r.appendChild(o),b.el=s,P.el=a,n(b),n(P)}}(e.className,e.appendTo||t.body),c=P,u="AB",r(l=b),r(c),k(l),k(c),n(l),n(c),I(0)}var l,c,u,d,h=e.lineHeight,p=e.shadowLineUp||0,f=e.shadowLine||0,_=e.showLine||2,g=e.columnSize||4,y=3*_+f+p,m=e.firstLineIndex||0,v=e.total||0,T=Math.ceil(v/g)||0,M=function(t,i){return e.render(t,i)||""},I=function(t){return e.update({turnLine:t,total:v,columnSize:g,showLine:_,totalLine:T,blockLines:y,shadowLine:f,firstLineIndex:m})},w=e.lockTime||300;d=e.paddingItem,i=(new Array(g*y).join(d+",")+d).split(",");var b={el:null,type:"A",check:function(e){return e<0?function(e){if(-(_+p)<e&&e<0)return!0}(this.top)&&-1:0<e?function(e){if(e<-(_+p)&&2*-(_+p)<e)return!0}(this.top)&&1:void 0},moveCalc:function(e){this.top+=e},transfer:function(e){var t;Logger.debug("down masterSlaveType",u),e<0&&(this.other.topIndex+y>=T?(Logger.debug("transfer = 0 1"),e=0):(this.top=this.other.top+y,this.topIndex=this.other.topIndex+y)),0<e&&(this.other.topIndex<=0?(Logger.debug("transfer = 0 2"),e=0):(this.top=this.other.top-y,this.topIndex=this.other.topIndex-y)),e&&(r(this),t=l,l=c,c=t,u=u[1]+u[0],k(this))},move:function(){this.el.style.webkitTransform="translateY("+this.top*h+"px)"}},P={el:null,type:"B",check:b.check,moveCalc:b.moveCalc,move:b.move,transfer:b.transfer};function k(e){var t=e.topIndex*g;e.el.innerHTML=function(e){if(v<=e)return"";var t=e+y*g;v<t&&(t=v);var n="";return e<0&&(n=i.slice(0,-1*e).join(""),e=0),t<0&&(t=0,n=""),n+M(e,t)}(t)}(b.other=P).other=b,a(m);var S,L,x,E,U=(S=w,L=-1,x=Math.max(300,S),E=1,{lock:function(e){return L=(new Date).getTime()+x*E*(e||1),!0},isLocked:function(){if(L>=(new Date).getTime())return!0;this.down()},up:function(){return E<5&&E++,this},down:function(){return 1<E&&E--,this}});function D(e,t,i){try{e.apply(i,t)}catch(e){U.up().lock(2)}}function C(){D(s,arguments)}function B(){D(o,arguments)}return{dragUp:function(){!U.isLocked()&&U.lock()&&C()},dragDown:function(){!U.isLocked()&&U.lock()&&B()},dragPageUp:function(){!U.isLocked()&&U.lock(2)&&C(-_)},dragPageDown:function(){!U.isLocked()&&U.lock(2)&&B(_)},refresh:function(e,t){v=t,T=Math.ceil(v/g)||0,a(e)}}}}function initAutoHide(e){var t=function(i){if(!(this instanceof t))return new t(i);var n={$dom:e(i.dom),delay:i.delay,beforeShow:i.beforeShow,afterHide:i.afterHide},r=function(){t.reseted||(s.isShow=!1,o.clear(),n.$dom.hide(),apply(n.afterHide,null,i))},o=new Timer(r,n.delay),s={isShow:!1,show:function(e){t.reseted||(s.isShow||(s.isShow=!0,apply(n.beforeShow,null,i),n.$dom.show()),o.begin(e))},hide:r};return s};return t.reset=function(){t.reseted||(t.reseted=!0)},t}function initToast(e){var t=function(i){var n,r,o=!(this instanceof t),s={delay:i&&0<=i.delay?i.delay:-1,msg:i&&i.msg||"",create:i&&i.create||function(){var t=e("<div>").css({position:"absolute",width:"100%",left:"0",top:"80%","z-index":"999","text-align":"center",background:"transparent"});return e("<div class=contentmsg>").css({display:"inline-block","font-family":"黑体","font-size":e.toPx("%3.125px"),color:"#F1F1F1",border:"1px solid white",padding:".1em 2em","min-height":"1.1em","border-radius":"18px","background-color":"rgba(0, 0, 0, .5)",position:"static",width:"auto",height:"auto","line-height":"normal","font-weight":"normal"}).appendTo(t),t},setMsg:i&&i.setMsg||function(t,i){e(".contentmsg",i).html(t)}};function a(i){var a="number"==typeof(i&&i.delay)?i.delay:s.delay,l=i&&i.msg||s.msg;o&&(n=t.dom,r=t.autoHide),n||((n=e(s.create())).appendTo("body"),r=new $.AutoHide({dom:n[0],delay:s.delay})),o&&(t.dom=n,t.autoHide=r),l&&a?(s.setMsg(l,n[0]),r.show(a)):r.hide()}if(!o)return a;a.apply(null,arguments)};return t}function initCutFactory(e){var t=document;return e&&(t=e.document),function(i){var n={padding:i.padding||"...",classList:i.classList||[],style:i.style||{},retry:i.retry||4,debug:i.debug},r=0,o=t.createElement("span");o.className=n.classList.join(" ");var s=[];for(var a in n.style)n.style.hasOwnProperty(a)&&s.push(a+":"+n.style[a]);o.style.cssText="position:absolute;left:0;top:0;background:transparent;color:transparent;height:100%;white-space:nowrap;overflow:visible;border:0;"+(n.debug?"background:white;color:red;":"")+s.join(";");var l=t.createElement("div");l.appendChild(o),l.style.cssText="width:99%;min-height:50px;line-height:50px;position:absolute;left:3px;top:3px;overflow:hidden;outline:0;background:transparent;"+(n.debug?"outline:1px solid red;background:black;":""),t.body.appendChild(l);var c=e.getComputedStyle(o);function u(){var e=o.offsetWidth,t=o.scrollWidth;return{gap:t-e,percent:Math.floor(e/t*1e3)/1e3}}return n.fontSize=parseFloat(c.fontSize)||16,function(e){r=n.retry;var t={flag:!1,cut:"",all:o.innerHTML=e,last:e};return u().gap&&(t.flag=!0,t.last=t.cut=function e(t){o.innerHTML=t+n.padding;var i=u(),s=i.gap,a=i.percent,l=+(t.length*a).toFixed(0);return 0<s&&s<n.fontSize&&(r--,l-=1),s<=0||!r?t+n.padding:e(t.substring(0,l))}(e)),t}}}function Trio(e){this.opt={channelMap:e&&e.channelMap||{}}}function Common(win,Query,commonProtoDiy){win||(win=window);var doc=win.document;!function(root,doc){function ext(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function map(e,t){for(var i=0,n=e.length;i<n;i++)e[i]=t(e[i]);return e}function Media(e){ext(this,e),1===this.mediaType?this.endTime=+localStorage.mpChanTimeShiftLength||7200:(void 0!==this.startTime&&""!=this.startTime||(this.startTime="0"),void 0!==this.endTime&&""!=this.endTime||(this.endTime=(Math.round(localStorage.mpEndTime)||Math.round(2.7*Math.random()*60*60)).toString())),this.entryID=Math.round(255*Math.random())}function MediaPlayer(){this.___process=null,this.__process=null,this.__native_player_instance_id=Math.round(255*Math.random()),this.__playback_mode="{PlayMode:Pause}",this.___speed=1,this.__speed=1,this.__volume=10,this.__current_play_time=0,this.__allow_trickmode_flag=1,this.__audio_track="Chinese",this.__audio_volume_ui_flag=1,this.__audio_track_ui_flag=1,this.__channel_no_ui_flag=1,this.__channel_num=-1,this.__current_audio_channel="Left",this.__current_index=0,this.__entry_id="entryid",this.__last_err=0,this.__play_list=[],this.__progress_bar_ui_flag=1,this.__subtitle="Chinese",this.__subtitle_flag=0,this.__vendor_specific_attr="",this.__video_alpha=0,this.__video_display_left=0,this.__video_display_top=0,this.__video_display_width=0,this.__video_display_height=0,this.__mute_flag=0,this.__mute_ui_flag=1,this.__native_ui_flag=1,this.__single_or_playlist_mode=0,this.__video_display_mode=1}window.Utility&&"function"==typeof window.Utility.getValueByName||(void 0===root.Utility&&(root.Utility={}),ext(root.Utility,{__event:null,getEvent:function(){return JSON.stringify(this.__event)},setEvent:function(e){this.__event=e}}),ext(Media.prototype,{mediaURL:"",mediaCode:"",mediaType:1,audioType:1,videoType:1,streamType:1,drmType:1,fingerPrint:1,copyProtection:0,allowTrickmode:1,startTime:"",endTime:"",entryID:0}),function(){Object.defineProperties(MediaPlayer.prototype,{__process:{set:function(e){e?0==this.__speed?this.__playback_mode="{PlayMode:Pause}":1==this.__speed?this.__playback_mode="{PlayMode:Normal Play}":this.__playback_mode="{PlayMode:Trickmode, Speed:"+this.__speed+"x}":this.__playback_mode="{PlayMode:Stop}",this.___process=e},get:function(){return this.___process}},__speed:{set:function(e){this.__process?this.__playback_mode=0==e?"{PlayMode:Pause}":1==e?"{PlayMode:Normal Play}":"{PlayMode:Trickmode, Speed:"+e+"x}":this.__playback_mode="{PlayMode:Stop}",this.___speed=e},get:function(){return this.___speed}}});var nullF=function(){},dispatchEvent=function(e){top.Utility.setEvent({type:e}),setTimeout(top.keyEvent,0,{keyCode:768})},stop=function(){this.__process&&(clearInterval(this.__process),this.__process=null),this.__processTimer&&(clearTimeout(this.__processTimer),this.__processTimer=null),this.__processTimerBeginDelay&&(clearTimeout(this.__processTimerBeginDelay),this.__processTimerBeginDelay=null),showVideoInfo.call(this)},pause=function(){this.__process&&(clearInterval(this.__process),this.__speed=0),showVideoInfo.call(this)},getCurrentMedia=function(){return JSON.parse(this.getPlaylist())[this.getCurrentIndex()]||null},play=function(){var e=this;clearInterval(this.__process);var t=getCurrentMedia.call(this);if(t){var i=+localStorage.mpMediaToPlayDelay||0;this.__play_list.first&&(i+=+localStorage.mpMediaBegingDelay||0),e.__processTimer=setTimeout(function(){e.__process=setInterval(n,1e3)},i),this.__play_list.first&&(this.__play_list.first=!1,e.__processTimerBeginDelay=setTimeout(function(){dispatchEvent("EVENT_MEDIA_BEGINING"),n()},+localStorage.mpMediaBegingDelay||0)),showVideoInfo.call(e)}function n(){var i=e.__current_play_time+e.__speed;if(1!=t.mediaType)i<=0&&(i=0,e.__speed=1),i>t.endTime?1!=e.__speed?(e.__current_play_time=t.endTime-5,e.__speed=1):(stop.call(e),dispatchEvent("EVENT_MEDIA_END")):e.__current_play_time=i;else{var n=new Date,r=(n.getTime()+60*n.getTimezoneOffset()*1e3)/1e3;r<=i?(e.__current_play_time=r,e.__speed=1):e.__current_play_time=i}showVideoInfo.call(e)}},strftime=function(e){var t=""+e,i=getCurrentMedia.call(this);if(i&&1==i.mediaType){var n=new Date(1e3*e),r=n.getFullYear(),o=n.getMonth()+1,s=n.getDate(),a=n.getHours(),l=n.getMinutes(),c=n.getSeconds();o<10&&(o="0"+o),s<10&&(s="0"+s),a<10&&(a="0"+a),l<10&&(l="0"+l),c<10&&(c="0"+c),t=""+r+o+s+"T"+a+l+c+".00Z"}return t},parsetime=function(e){var t=parseInt(e);if(1==getCurrentMedia.call(this).mediaType){var i=e.substring(0,4),n=e.substring(4,6)-1,r=e.substring(6,8),o=e.substring(9,11),s=e.substring(11,13),a=e.substring(13,15),l=new Date(i,n,r,o,s,a).getTime(),c=new Date;c.setMinutes(c.getMinutes()+c.getTimezoneOffset()),c=c.getTime();var u=1e3*this.__play_list[this.__current_index].endTime;l<c-u&&(l=c-u),t=parseInt(l/1e3)}return t},getCurrentTime=function(){return strftime.call(this,this.__current_play_time)},isValidSpeed=function(e){var t=Math.log(Math.abs(e))/Math.log(2);return(0|t)==t},showVideoInfo=function(){if(this.el){var e=this.__current_play_time,t=this.getMediaDuration();this.el.html(["音量 : "+this.__volume,"静音 : "+!!this.__mute_flag,"状态 : "+this.__playback_mode.replace("{PlayMode:","").replace("}",""),"时间 : "+[e,t].join("/")].join("</br>"))}};ext(MediaPlayer.prototype,{addBatchMedia:function(e){},addSingleMedia:function(e,t){},bindNativePlayerInstance:function(e){},clearAllMedia:function(){},fastForward:function(e){isValidSpeed(e)&&0<e?this.__speed=e:this.__speed=1,play.call(this)},fastRewind:function(e){isValidSpeed(e)&&e<0?this.__speed=e:this.__speed=1,play.call(this)},get:function(e){},getAudioPID:function(){},getAudioPIDs:function(){},getSubtitlePID:function(){},getSubtitlePIDs:function(){},getVolume:function(){return this.__volume},gotoEnd:function(){var e=getCurrentMedia.call(this);if(e)if(1==e.mediaType){var t=new Date;this.playByTime(2,strftime.call(this,Math.round((t.getTime()+60*t.getTimezoneOffset()*1e3)/1e3)))}else this.playByTime(1,e.endTime-5)},gotoStart:function(){var e=getCurrentMedia.call(this);e&&1!=e.mediaType&&this.playByTime(1,0)},initMediaPlayer:function(e,t,i,n,r,o,s,a,l,c,u,d,h,p){this.__instance_id=e},joinChannel:function(e){this.__play_list=[new Media({mediaType:1})],this.__channel_num=e,this.__current_index=0,this.gotoEnd(),dispatchEvent("EVENT_GO_CHANNEL")},leaveChannel:function(){},moveMediaByIndex:function(e,t){},moveMediaByIndex1:function(e,t){},moveMediaByOffset:function(e,t){},moveMediaByOffset1:function(e,t){},moveMediaToFirst:function(e){},moveMediaToFirst1:function(e){},moveMediaToLast:function(e){},moveMediaToLast1:function(e){},moveMediaToNext:function(e){},moveMediaToNext1:function(e){},moveMediaToPrevious:function(e){},moveMediaToPrevious1:function(e){},pause:function(){pause.call(this)},playByTime:function(e,t,i){t=t.toString();var n=parsetime.call(this,t);isNaN(n)||(this.__current_play_time=n),isValidSpeed(i)?this.__speed=i:this.__speed=1,play.call(this)},playFromStart:function(){this.playByTime(1,0)},refreshVideoDisplay:function(){if(!this.el||!this.el.length){var e="<div id=sys_mp_"+this.__native_player_instance_id+" class=sys_mp></div>",t=this.el=root.$(e);$(function(){t.appendTo(doc.body)})}this.el.css({position:"absolute",left:this.__video_display_left+"px",top:this.__video_display_top+"px",width:this.__video_display_width?this.__video_display_width+"px":"100%",height:this.__video_display_height?this.__video_display_height+"px":"100%"})},releaseMediaPlayer:function(e){this.stop(),this.__play_list=[],this.el&&this.el.remove()},removeMediaByEntryID:function(e){},removeMediaByIndex:function(e){},resume:function(){var e=this.__play_list[this.__current_index];if(e)if(1==e.mediaType){var t=strftime.call(this,this.__current_play_time);this.playByTime(1,t)}else this.playByTime(1,this.__current_play_time)},selectFirst:function(){},selectLast:function(){},SelectMediaByEntryID:function(e){},selectMediaByIndex:function(e){},selectMediaByOffset:function(e){},selectNext:function(){},selectPrevious:function(){},sendVendorSpecificCommand:function(e){},set:function(e,t){},setAudioPID:function(){},setSingleMedia:function(mediaStr){var arr;if("string"==typeof mediaStr)try{arr=JSON.parse(mediaStr),UTIL.isArray(arr)||(arr=[arr])}catch(e){var arr=[];str=mediaStr.match(/^ *\[ *\{ *(.*) *\} *\] *$/)[1],tokens=str.split(","),media={};for(var i=0,len=tokens.length,item;i<len;i++)item=tokens[i].split(":"),item[1]=item.slice(1).join(),media[item[0]]=eval(item[1]);arr.push(media)}else arr=[mediaStr];for(var i=0,len=arr.length;i<len;i++)arr[i]=new Media(arr[i]);this.__play_list=arr,this.__play_list.first=!0},setSubtitlePID:function(e){},setVolume:function(e){this.__volume=parseInt(e),showVideoInfo.call(this)},stop:function(){stop.call(this)},switchAudioChannel:function(){},switchAudioTrack:function(){},switchSubtitle:function(){}}),ext(MediaPlayer.prototype,{getCurrentPlayTime:getCurrentTime,getAllowTrickmodeFlag:function(){return this.__allow_trickmode_flag},getAudioTrack:function(){return this.__audio_track},getAudioVolumeUIFlag:function(){return this.__audio_volume_ui_flag},getAudioTrackUIFlag:function(){return this.__audio_track_ui_flag},getChannelNoUIFlag:function(){return this.__channel_no_ui_flag},getChannelNum:function(){return this.__channel_num},getCurrentAudioChannel:function(){return this.__current_audio_channel},getCurrentIndex:function(){return this.__current_index},getEntryID:function(){var e=getCurrentMedia.call(this);return e&&e.entryID},GetLastError:function(){return this.__last_err},getMediaCode:function(){var e=getCurrentMedia.call(this);return e&&e.mediaCode},getMediaCount:function(){return JSON.parse(this.getPlaylist()).length},getMediaDuration:function(){var e=getCurrentMedia.call(this);return e&&1!=e.mediaType?parseInt(e.endTime):-1},getPlaybackMode:function(){return this.__playback_mode},getPlaylist:function(){return JSON.stringify(this.__play_list)},getProgressBarUIFlag:function(){return this.__progress_bar_ui_flag},getSubtitle:function(){return this.__subtitle},getSubtitileFlag:function(){return this.__subtitle_flag},getVendorSpecificAttr:function(){return this.__vendor_specific_attr},getVideoAlpha:function(){return this.__video_alpha},getVideoDisplayLeft:function(){return this.__video_display_left},getVideoDisplayTop:function(){return this.__video_display_top},getVideoDisplayWidth:function(){return this.__video_display_width},getVideoDisplayHeight:function(){return this.__video_display_height},getMuteFlag:function(){return this.__mute_flag},getMuteUIFlag:function(){return this.__mute_ui_flag},getNativePlayerInstanceID:function(){return this.__native_player_instance_id},getNativeUIFlag:function(){return this.__native_ui_flag},getSingleOrPlaylistMode:function(){return this.__single_or_playlist_mode},getVideoDisplayMode:function(){return this.__video_display_mode},setAllowTrickmodeFlag:function(e){},setAudioTrackUIFlag:function(e){},setAudioVolumeUIFlag:function(e){},setChannelNoUIFlag:function(){},setMuteFlag:function(e){this.__mute_flag=e,showVideoInfo.call(this)},setMuteUIFlag:function(e){},setNativeUIFlag:function(e){},setProgressBarUIFlag:function(){},setSubtitileFlag:function(e){},setSingleOrPlaylistMode:function(e){},setVendorSpecificAttr:function(e){},setVideoAlpha:function(e){this.__video_alpha=e},setVideoDisplayArea:function(e,t,i,n){this.__video_display_left=parseInt(e),this.__video_display_top=parseInt(t),this.__video_display_width=parseInt(i),this.__video_display_height=parseInt(n)},setVideoDisplayMode:function(e){this.__video_display_mode=e}})}(),ext(root,{MediaPlayer:MediaPlayer}))}(win,doc);var search=Search(doc,win),AnimatePanel=initAnimatePanel(win),AutoHide=initAutoHide(win.Query),Toast=initToast(win.Query),topic=new Topic,Lathe=initCutFactory(win);return merge(function(e,t,i){if("function"!=typeof e){if(t&&t instanceof Query){if(!t.length)return t;t=t[0]}return new Query(e,t,i)}ready(e,doc)},{tokens:Math.random(),Date:Date2,search:search,page:search.get(),log:Logger,UTIL:UTIL,extend:UTIL.extend,Toast:Toast,Timer:Timer,AutoHide:AutoHide,Tpl:Tpl,Tps:Tps,Lathe:Lathe,VideoList:VideoList,MP:MP,Topic:Topic,topic:topic,KB:EPG.KB,keyTool:keyTool,pTool:pTool,Marquee:Marquee2,FetchData:FetchData,AnimatePanel:AnimatePanel,ajax:ajax,get:get,post:post,Services:Services,s:SERVICES,getVariable:getVariable,getHelper:getHelper,vs:VS},{urls:{add:function(e){var t=this;each(e,function(e,i){t[i]=e}),t=null},home:EPG.pathPage+"/home/",dataHome:EPG.pathSite+"/linn/home/",dataVanHome:EPG.pathSite+"/linn/vanHome/",dataMenu:EPG.pathSite+"/linn/menu/",dataVanMenu:EPG.pathSite+"/linn/vanMenu/",dataRecommend0:EPG.pathSite+"/linn/recommend0/",dataRecommend2:EPG.pathSite+"/linn/recommend2/",dataRecommend3:EPG.pathSite+"/linn/recommend3/"},forward:function(e,t){apply(this.addBackUrl||top.cwindow&&top.cwindow.$&&top.cwindow.$.addBackUrl||this.saveBackUrl,[t||top.cwindow&&top.cwindow.location.href,e],this),this.redirect(e)},redirect:function(e){var t=search.append(e,{POSITIVE:""});this.setUrl(t)},back:function(){var e=this.getBackUrl(!0);e&&(this.back=function(){this.setUrl(e)},this.back())},setUrl:function(e){if(top.cwindow){var t=top.cwindow.location.href;"about:blank"==t&&(t=""),window.referrer=t,top.cwindow.location.href=e}else Logger.out.error="not exists cwindow!"},isBack:function(){return null===search.get("POSITIVE")},isBackRedefine:function(e){this.isBack=function(){return!!e}},getChanById:function(e){if(e)try{var t,i,n=$.getHelper("data:channel").channelIdsMap;return UTIL.isArray(e)?(t=[],each(e,function(e){(i=n[e])&&t.push(sclone(i))})):(i=n[e])&&(t=sclone(i)),n=null,t}catch(e){$.log.out.error=["no channelIds %s",channelId]}},getChanNum:function(e){try{var t="channelMap";return 32===e.length&&(t="channelIdsMap"),$.getHelper("data:channel")[t][e].num}catch(t){$.log.out.error=["no channelNum %s",e]}},getMenu:function(e,t,i){try{if(!e)return $.getHelper("provider:menu").cache();var n=$.getHelper("provider:menu").cache.get(e,t);return i?n.path:n}catch(n){$.log.out.error=["no menu %s %s %s",e,t,i]}},getAuth:function(){try{return getHelper("provider:auth").auth}catch(e){$.log.out.error=["get auth error"]}}},commonProto,commonProtoDiy)}PureList.prototype={constructor:PureList,all:function(){return this._.list},next:function(){var e=this._.current+1;if(e>=this._.total){if(!this._.loop)return!1;e=0}return this._.current=e,this.current()},current:function(){return this._.list[this._.current]},currentIndex:function(){return this._.current}},PureList.prototype.constructor=PureList,VideoList.prototype=new PureList,merge(VideoList.prototype,{constructor:VideoList,init:function(){this.inited||(this.inited=!0,this._loaded=this._loaded.bind(this),this._loaded_prevideo=this._loaded_prevideo.bind(this),this._success=this._success.bind(this),this._success_prevideo=this._success_prevideo.bind(this),this._ended=this._ended.bind(this),this._ended_prevideo=this._ended_prevideo.bind(this),this._error=this._error.bind(this),this._error_prevideo=this._error_prevideo.bind(this),this._over_prevideo=this._over_prevideo.bind(this),this.mp=new MP(this.cfg))},release:function(){this.mp&&(apply(this.mp.release,null,this.mp),this._loaded=this._success=this._ended=this._error=this.mp=null,this._loaded_prevideo=this._success_prevideo=this._ended_prevideo=this._error_prevideo=this._over_prevideo=null),this.cfg&&(this.cfg=null),this._&&(this._=null)},valueOf:function(){var e=sclone(this._);if(e){if(delete e.loop,e.diy=this.cfg&&this.cfg.diy,!this.seeking&&this.inited&&this.mp){if(!this.mp.isState($.MP.state.ended))var t=apply(this.mp.getCurrentTime,null,this.mp)||this.mp.cache.startTime;if(!e.pre.length)return e.playTime=t,e.endPoint=this.mp.cache.endPoint,e;e.pre[0].playTime=t}this.cfg&&(e.playTime=this.cfg.playTime,e.endPoint=this.cfg.endPoint)}return e},_success_prevideo:function(e,t){this._success(e,t,!0)},_error_prevideo:function(){this._over_prevideo(this.cfg.onError)},_ended_prevideo:function(){this._over_prevideo(this.cfg.onEnd,!0)},_over_prevideo:function(e,t){this.stop(),this._.pre.length=0,apply(this._goon_prevideo);var i=[!(this._goon_prevideo=null)];t&&(i=[null,null,!0]),apply(e,i,this.cfg)},_loaded_prevideo:function(e){this._loaded(e,!0)},_success:function(e,t,i){Logger.debug("get playUrl.success",e,t),this.cfg&&(i?this._loadStream(e,t,i):apply(this.cfg.onBeforePlay,[function(e){e&&e.contentId?(this._.pre.push(e),this.fetch(e,this._success_prevideo,this._error_prevideo,e.playTime),delete e.playTime,e=null):this._error_prevideo()}.bind(this),function(e){setTimeout(e,0)}.bind(this,this._loadStream.bind(this,e,t)),this._.pre.pop()],this.cfg))},_loaded:function(e,t){Logger.debug("MP.loaded"),apply(this.cfg.onPlay,[e,sclone(this.current()),t],this.cfg)},_ended:function(){Logger.debug("MP.ended"),this._checkAutoNext()},_error:function(){Logger.debug("MP.error"),apply(this.cfg.onError,null,this.cfg)||this._checkAutoNext()},_allEnded:function(){var e=sclone(this.current()),t=this.currentIndex();delete this.cfg.playTime,this._.list.length&&(this._.current=0),apply(this.cfg.onEnd,[t,e],this.cfg),t=e=null},_checkAutoNext:function(){this.cfg.auto&&this.next()?this.play():this._allEnded()},_loadStream:function(e,t,i){apply(this.cfg.loading,["stream",i],this.cfg),this._dealEvent(!1,i);var n=0;i||(this.cfg.playTime=0,n=this.cfg.endPoint),this.mp.load(e,t,null,n)},_dealEvent:function(e,t){if(this.mp){var i=e?"rmOnce":"once";(e||t)&&(this.mp[i](MP.state.loaded,this._loaded_prevideo),this.mp[i](MP.state.ended,this._ended_prevideo),this.mp[i](MP.state.error,this._error_prevideo)),t||(this.mp[i](MP.state.loaded,this._loaded),this.mp[i](MP.state.ended,this._ended),this.mp[i](MP.state.error,this._error))}},play:function(){this.stop(),this.init();var e=this._.pre.length;this._dealEvent(!0,e);var t=this.current();t?(apply(this.cfg.loading,["url"],this.cfg),this.fetch(t,this._success,this._error,this.cfg.playTime)):this._allEnded()},diy:function(e){return $.UTIL.isUndefined(e)?sclone(this.cfg.diy):(this.cfg.diy=sclone(e),this)},seek:function(e){this.seeking=!0;var t=e.key||"index",i=e.val,n=+e.playTime||0,r=-1;if("index"==t)r=+i;else{var o={key:t,val:i,index:-1};each(this._.list,(e.filter||function(e,n){if(e[t]===i)return this.index=n,!0}).bind(o)),r=o.index}return this.diy(e.diy),this.cfg.playTime=n,this.cfg.current=this._.current=r,this._.pre.length=0,this},playBy:function(e){this.seek(e),this.play()},stop:function(){delete this.seeking,apply(this.mp&&this.mp.stop,null,this.mp)},fetch:function(e,t,i,n){if(e.playUrl)setTimeout(t,0,e.playUrl,n);else{var r=!!e.contentId,o=e.channelId&&e.startTime;if(r||o){if(r)$.getHelper("provider:vod").fetch(e.contentId,function(r){r&&r.playURL?(e.playUrl=r.playURL,t(r.playURL,n)):i(r)},i);else if(o){var s=e.startTime;s=(new $.Date).parse(s,"yyyy-MM-dd hh:mm:ss").getTime(),$.getHelper("provider:tvod").fetch(e.channelId,s,null,function(n){n&&n.playURL?(e.playUrl=n.playURL,t(n.playURL)):i(n)},i)}}else i(new Error("no contentId"))}}}),function(){var e=function(e,t){!function(e,t){if(/\d{32}/.test(e.contentId))return t({contentId:e.contentId,seriesId:e.seriesId});$.s.trio.query({contentId:e.contentId,seriesId:e.seriesId||""},{success:function(e){e&&e.data?t({contentId:e.data.vodId,seriesId:e.data.seriesId}):t()},error:t})}(e,function(e){e&&e.contentId?$.s.vod.play({id:e.contentId,seriesId:e.seriesId},{success:function(e){t(e&&e.playURL||void 0,"")},error:function(){t()}}):t()})},t=function(e,t,i){if(e){var n=e[""+t];if(n)return i(n.channelNum,n.name)}i()},i={vod:function(t,i){e(t,i)},series:function(t,i){e(t,i)},xileiju:function(t,i){e(t,i)},tvod:function(e,i){e.channelNum&&e.startTime&&e.endTime?t(this.opt.channelMap,e.channelNum,function(t,n){if(!t)return i();$.s.tvod.query({channelNum:t,startTime:e.startTime},{success:function(e){try{/PROGID=[^&]+/.test(e)?$.s.tvod.play({params:e},{success:function(e){i(e&&e.playURL)},error:i}):i()}catch(e){i()}},error:i})}):i()},live:function(e,i){t(this.opt.channelMap,e.channelNum,i)}},n=function(e){topFrame&&topFrame.contentWindow&&(topFrame.contentWindow.location=e)};UTIL.merge(Trio.prototype,{PLAYTYPE:{vod:"vod",series:"series",xileiju:"xileiju",tvod:"tvod",live:"live"},fetchPlayData:function(e){e&&e.type&&"function"==typeof e.callback&&function(e,t,n){try{return apply(i[t.type],[t,n],e)}catch(e){}n()}(this,e,e.callback)},back:function(){var e;(e=$.getBackUrl(!0))&&n(e)},auth:function(e){var t,i,n;e&&e.package&&"function"==typeof e.callback&&(i=(t=e).callback,n=[],each(t.package,function(e){n.push({chargeId:e})}),$.getAuth().auth({entrance:t.entrance||"",package:n,callback:function(e){i(!!e)}}))},buy:function(e){var t,i;e&&(t=e,i=$.search.append(EPG.pathPage+"/noAuth/transferPage/",{backUrl:encodeURIComponent(t),POSITIVE:void 0}),n(i))}})}();