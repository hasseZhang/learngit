var pageName="PBL_EMAIL_text",pageInfo=$.initPageInfo(pageName,["index","textIndex"],{index:0,textIndex:0});function load(){var t=$.getGlobalData("PBL_EMAIL_DATA");t.id&&(newName=pageName+"-"+t.id,$.recodeData(newName,"access")),$.pTool.get("text").init(t)}function unload(){$.savePageInfo(pageName,$.pTool.get("text").getIndex())}$.pTool.add("text",function(){var t,e,n=pageInfo.index,a=!1,i=[],r=!1,o=pageInfo.textIndex,l=[],f=[],c=!1,u="",x="";function s(t){"#textUrl"==t&&(t+=o),$.focusTo({el:t})}function d(t){$(".text").css({top:"-"+t+"px"})}function p(a){if($(".text").css("webkitTransition","all 0.5s ease 0s"),u="","#downBtn"==$.activeObj.el){if(1==a)return;$("#upBtn").removeClass("unactive"),n=++n>Math.ceil(t/e)-1?Math.ceil(t/e)-1:n,d(e*n)}if("#upBtn"==$.activeObj.el){if(2==a)return;$("#downBtn").removeClass("unactive"),d(e*(n=--n<0?0:n))}0==n&&($("#upBtn").addClass("unactive"),s("#downBtn")),n==Math.ceil(t/e)-1&&($("#downBtn").addClass("unactive"),s("#upBtn"))}function v(){for(var t=0;t<i.length;t++){var e=parseInt($(".text").css("top"))+$(".text").find("#textUrl"+t).offsetTop();e>=0&&e<624&&(r=!0,f.push(e),l.push(t))}}function g(){c&&s(n?"#upBtn":"#downBtn")}function B(t){for(var e=0;e<t.length;e++)if(o==t[e])return e}function I(){if(1==i.length)u=o,g();else if(i.length>1){var t=B(l);t==l.length-1?(u=o,g()):(nextIndex=function(t){for(var e=t;e<f.length;e++)if(f[t]!=f[e])return l[e]}(t),nextIndex?(o=nextIndex,s("#textUrl")):(u=o,g()))}}function U(){if(o&&1!=i.length){var t=B(l);0!=t&&(nextIndex=function(t){for(var e=t;e>=0;e--)if(f[t]!=f[e])return l[e]}(t),(nextIndex||0===nextIndex)&&(o=nextIndex,s("#textUrl")))}}return{key:"text",dft:!0,keysDftMap:["KEY_LEFT","KEY_RIGHT","KEY_OK","KEY_UP","KEY_DOWN","KEY_PAGEUP","KEY_PAGEDOWN"],keysMap:{KEY_LEFT:function(){return"#downBtn"!=$.activeObj.el||/unactive/.test($("#upBtn").attr("class"))||s("#upBtn"),/textUrl/.test($.activeObj.el)&&function(){var t=B(l);if(0!=t){var e=l[t-1];$("#textUrl"+o).offsetTop()==$("#textUrl"+e).offsetTop()&&(o=e,s("#textUrl"))}}(),!0},KEY_RIGHT:function(){return"#upBtn"!=$.activeObj.el||/unactive/.test($("#downBtn").attr("class"))||s("#downBtn"),/textUrl/.test($.activeObj.el)&&function(){var t=B(l);if(t!=l.length-1){var e=l[t+1];$("#textUrl"+o).offsetTop()==$("#textUrl"+e).offsetTop()&&(o=e,s("#textUrl"))}}(),!0},KEY_OK:function(){var t;return/textUrl/.test($.activeObj.el)?((t=i[o]).categoryId=x,$.gotoDetail(t)):p(),!0},KEY_UP:function(){return/textUrl/.test($.activeObj.el)?U():function(){if(l=[],f=[],r=!1,v(),r){if(u||0===u)o=u;else{var t=l.length;o=l[t-1]}s("#textUrl")}}(),!0},KEY_DOWN:function(){return/textUrl/.test($.activeObj.el)?I():"#downBtn"!=$.activeObj.el&&$("#upBtn").length&&(r=!1,/unactive/.test($("#upBtn").attr("class"))?s("#downBtn"):s("#upBtn")),!0},KEY_PAGEUP:function(){a||(s("#upBtn"),p(1))},KEY_PAGEDOWN:function(){a||(s("#downBtn"),p(2))}},init:function(o){x=o.categoryId,(a=o.urlSign)&&(i=o.data);var l=function(t){if(t&&t.text){var e=0;return t.text=t.text.replace(/\r\n|\\r\\n/g,"<br>").replace(/ /g,"&nbsp;").replace(/@([^@]+)@/g,function(t,n,a,i){return'<span id="textUrl'+e+++'"  class="textUrl">'+n+"</span>"}),"<p>"+t.text+"</p>"}}(o);if($(".text").html(l),r&&v(),t=$(".text").offsetHeight(),e=$(".right").offsetHeight(),$.isBack()){var f="-"+ +n*e+"px";$(".text").css("top",f)}a&&v(),t>e&&($('<div class="btn"><div id="upBtn">上一页</div><div id="downBtn">下一页</div></div>').appendTo("body"),!n&&$("#upBtn").addClass("unactive"),n==Math.ceil(t/e)-1&&$("#downBtn").addClass("unactive"),c=!0),r?s("#textUrl"):c&&s("#downBtn")},getIndex:function(){return{index:n,textIndex:o}}}}());