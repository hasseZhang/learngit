var pageName="PBL_EMAIL_textImg",pageInfo=$.initPageInfo(pageName,["index","textIndex"],{index:0,textIndex:0});function load(){var t=$.getGlobalData("PBL_EMAIL_DATA");t.id&&(newName=pageName+"-"+t.id,$.recodeData(newName,"access")),$.pTool.get("textImg").init(t)}function unload(){$.savePageInfo(pageName,$.pTool.get("textImg").getIndex())}$.pTool.add("textImg",function(){var t,e,n=pageInfo.index,a=!1,i=[],r=!1,o=pageInfo.textIndex,c=[],l=[],f=!1,s="",u="";function x(t){"#textUrl"==t&&(t+=o),$.focusTo({el:t})}function d(t){$(".text").css({top:"-"+t+"px"})}function p(a){if($(".text").css("webkitTransition","all 0.5s ease 0s"),s="","#downBtn"==$.activeObj.el){if(1==a)return;$("#upBtn").removeClass("unactive"),n=++n>Math.ceil(t/e)-1?Math.ceil(t/e)-1:n,d(e*n)}if("#upBtn"==$.activeObj.el){if(2==a)return;$("#downBtn").removeClass("unactive"),d(e*(n=--n<0?0:n))}0==n&&($("#upBtn").addClass("unactive"),x("#downBtn")),n==Math.ceil(t/e)-1&&($("#downBtn").addClass("unactive"),x("#upBtn"))}function v(){for(var t=0;t<i.length;t++){var e=parseInt($(".text").css("top"))+$(".text").find("#textUrl"+t).offsetTop();e>=0&&e<728&&(r=!0,l.push(e),c.push(t))}}function g(){f&&x(n?"#upBtn":"#downBtn")}function B(t){for(var e=0;e<t.length;e++)if(o==t[e])return e}function I(){if(1==i.length)s=o,g();else if(i.length>1){var t=B(c);t==c.length-1?(s=o,g()):(nextIndex=function(t){for(var e=t;e<l.length;e++)if(l[t]!=l[e])return c[e]}(t),nextIndex?(o=nextIndex,x("#textUrl")):(s=o,g()))}}function h(){if(o&&1!=i.length){var t=B(c);0!=t&&(nextIndex=function(t){for(var e=t;e>=0;e--)if(l[t]!=l[e])return c[e]}(t),(nextIndex||0===nextIndex)&&(o=nextIndex,x("#textUrl")))}}function U(t){for(var e=0;e<t.length;e++)if(3==t[e].picType)return t[e].picPath}return{key:"textImg",dft:!0,keysDftMap:["KEY_LEFT","KEY_RIGHT","KEY_OK","KEY_UP","KEY_DOWN","KEY_PAGEUP","KEY_PAGEDOWN"],keysMap:{KEY_LEFT:function(){return"#downBtn"!=$.activeObj.el||/unactive/.test($("#upBtn").attr("class"))||x("#upBtn"),/textUrl/.test($.activeObj.el)&&function(){var t=B(c);if(0!=t){var e=c[t-1];$("#textUrl"+o).offsetTop()==$("#textUrl"+e).offsetTop()&&(o=e,x("#textUrl"))}}(),!0},KEY_RIGHT:function(){return"#upBtn"!=$.activeObj.el||/unactive/.test($("#downBtn").attr("class"))||x("#downBtn"),/textUrl/.test($.activeObj.el)&&function(){var t=B(c);if(t!=c.length-1){var e=c[t+1];$("#textUrl"+o).offsetTop()==$("#textUrl"+e).offsetTop()&&(o=e,x("#textUrl"))}}(),!0},KEY_OK:function(){var t;return/textUrl/.test($.activeObj.el)?((t=i[o]).categoryId=u,$.gotoDetail(t)):p(),!0},KEY_UP:function(){return/textUrl/.test($.activeObj.el)?h():function(){if(c=[],l=[],r=!1,v(),r){if(s||0===s)o=s;else{var t=c.length;o=c[t-1]}x("#textUrl")}}(),!0},KEY_DOWN:function(){return/textUrl/.test($.activeObj.el)?I():"#downBtn"!=$.activeObj.el&&$("#upBtn").length&&(r=!1,/unactive/.test($("#upBtn").attr("class"))?x("#downBtn"):x("#upBtn")),!0},KEY_PAGEUP:function(){a||(x("#upBtn"),p(1))},KEY_PAGEDOWN:function(){a||(x("#downBtn"),p(2))}},init:function(o){if(u=o.categoryId,a=o.urlSign,o.data.length)for(var c=0;c<o.data.length;c++)7==o.data[c].contentType&&o.data[c].pics.length&&(o.pic="/pic/"+U(o.data[c].pics));o.pic&&$(".pic img").attr("src",o.pic),a&&(i=o.data);o.text.replace(/@/g,"").length;var l=function(t){if(t&&t.text){var e=0;return t.text=t.text.replace(/\r\n|\\r\\n/g,"<br>").replace(/ /g,"&nbsp;").replace(/@([^@]+)@/g,function(t,n,a,i){return'<span id="textUrl'+e+++'"  class="textUrl">'+n+"</span>"}),"<p>"+t.text+"</p>"}}(o);if($(".text").html(l),r&&v(),t=$(".text").offsetHeight(),e=$(".right").offsetHeight(),$.isBack()){var s="-"+ +n*e+"px";$(".text").css("top",s)}if(a&&v(),t>e)$('<div class="btn"><div id="upBtn">上一页</div><div id="downBtn">下一页</div></div>').appendTo("body"),!n&&$("#upBtn").addClass("unactive"),n==Math.ceil(t/e)-1&&$("#downBtn").addClass("unactive"),f=!0;else{var d=parseInt($(".text p").css("height"));$(".text").css("top","50%"),$(".text p").css("marginTop","-"+d/2+"px")}r?x("#textUrl"):f&&x("#downBtn")},getIndex:function(){return{index:n,textIndex:o}}}}());