var pageName="PBL_EMAIL_vodText",pageInfo=$.initPageInfo(pageName,["index","textIndex","textFocus"],{index:0,textIndex:0,textFocus:!1});function load(){var t=$.getGlobalData("PBL_EMAIL_DATA");t.id&&(newName=pageName+"-"+t.id,$.recodeData(newName,"access")),t&&render(t)}function render(t){subData(t),t.contentId&&(pageInfo.textFocus&&($.isBack=function(){return!1}),window.vl=$.playSizeList({top:313,left:113,width:925,height:520,current:0,multiVod:!1,list:[{contentId:t.contentId,name:t.name}],onPlay:function(){$("#vod img").hide()}},t.categoryId)),$.pTool.get("vodText").init(t)}function subData(t){for(var e=0,n={},a=0;a<t.data.length;a++)"vod"==t.data[a].contentName.split("|")[1]&&(e=a,n=t.data.splice(e,1)[0],t.contentId=n.contentId,t.name=n.contentName.split("|")[0])}function unload(){vl&&vl.release&&vl.release(),$.savePageInfo(pageName,$.pTool.get("vodText").getIndex())}$.pTool.add("vodText",function(){var t,e,n,a,o=pageInfo.index,i=pageInfo.textIndex,r=!1,l=!1,c=pageInfo.textFocus,d=!c,s=[],u=[],f=[],v="";function x(t){"#textUrl"==t&&(t+=i),$.focusTo({el:t})}function p(t){$(".text").css({top:"-"+t+"px"})}function g(n){if($(".text").css("webkitTransition","all 0.5s ease 0s"),v="","#downBtn"==$.activeObj.el){if(1==n)return;$("#upBtn").removeClass("unactive"),o=++o>Math.ceil(t/e)-1?Math.ceil(t/e)-1:o,p(e*o)}if("#upBtn"==$.activeObj.el){if(2==n)return;$("#downBtn").removeClass("unactive"),p(e*(o=--o<0?0:o))}0==o&&($("#upBtn").addClass("unactive"),x("#downBtn")),o==Math.ceil(t/e)-1&&($("#downBtn").addClass("unactive"),x("#upBtn"))}function I(){for(var t=0;t<s.length;t++){var e=parseInt($(".text").css("top"))+$(".text").find("#textUrl"+t).offsetTop();e>=0&&e<728&&(c=!0,f.push(e),u.push(t))}}function B(){l&&x(o?"#upBtn":"#downBtn")}function h(t){for(var e=0;e<t.length;e++)if(i==t[e])return e}function U(){if(1==s.length)v=i,B();else if(s.length>1){var t=h(u);t==u.length-1?(v=i,B()):(nextIndex=function(t){for(var e=t;e<f.length;e++)if(f[t]!=f[e])return u[e]}(t),nextIndex?(i=nextIndex,x("#textUrl")):(v=i,B()))}}function b(){if(i&&1!=s.length){var t=h(u);0!=t&&(nextIndex=function(t){for(var e=t;e>=0;e--)if(f[t]!=f[e])return u[e]}(t),(nextIndex||0===nextIndex)&&(i=nextIndex,x("#textUrl")))}}return{key:"vodText",dft:!0,keysDftMap:["KEY_LEFT","KEY_RIGHT","KEY_OK","KEY_UP","KEY_DOWN","KEY_PAGEUP","KEY_PAGEDOWN"],keysMap:{KEY_LEFT:function(){return"#downBtn"==$.activeObj.el?/unactive/.test($("#upBtn").attr("class"))?(d=!0,x("#vod")):x("#upBtn"):"#upBtn"==$.activeObj.el&&(d=!0,x("#vod")),/textUrl/.test($.activeObj.el)&&function(){var t=h(u);if(!t)return d=!0,c=!1,void x("#vod");var e=u[t-1];$("#textUrl"+i).offsetTop()==$("#textUrl"+e).offsetTop()?(i=e,x("#textUrl")):(d=!0,c=!1,x("#vod"))}(),!0},KEY_RIGHT:function(){return"#upBtn"!=$.activeObj.el||/unactive/.test($("#downBtn").attr("class"))||x("#downBtn"),/textUrl/.test($.activeObj.el)&&function(){var t=h(u);if(t!=u.length-1){var e=u[t+1];$("#textUrl"+i).offsetTop()==$("#textUrl"+e).offsetTop()&&(i=e,x("#textUrl"))}}(),"#vod"==$.activeObj.el&&(u=[],f=[],c=!1,I(),c?(i=u[0],x("#textUrl")):l&&(/unactive/.test($("#upBtn").attr("class"))?x("#downBtn"):x("#upBtn"))),!0},KEY_OK:function(){if(/textUrl/.test($.activeObj.el))(t=s[i]).categoryId=n,$.gotoDetail(t);else if("#vod"==$.activeObj.el){if(c=!1,!$("#vod img")[0].className)return;vl&&vl.enter({contentId:a,mediaType:1,noHis:1})}else g();var t;return!0},KEY_UP:function(){return/textUrl/.test($.activeObj.el)?b():/Btn/.test($.activeObj.el)&&function(){if(u=[],f=[],c=!1,I(),c){if(v||0===v)i=v;else{var t=u.length;i=u[t-1]}x("#textUrl")}}(),!0},KEY_DOWN:function(){return/textUrl/.test($.activeObj.el)&&U(),!0},KEY_PAGEUP:function(){"#vod"!=$.activeObj.el&&!r&&l&&(x("#upBtn"),g(1))},KEY_PAGEDOWN:function(){"#vod"!=$.activeObj.el&&!r&&l&&(x("#downBtn"),g(2))}},active:function(){console.log(111)},init:function(i){n=i.categoryId,(r=i.urlSign)&&(s=i.data),a=i.contentId;i.text.replace(/@/g,"").length;var u=function(t){if(t&&t.text){var e=0;return t.text=t.text.replace(/\r\n|\\r\\n/g,"<br>").replace(/ /g,"&nbsp;").replace(/@([^@]+)@/g,function(t,n,a,o){return'<span id="textUrl'+e+++'"  class="textUrl">'+n+"</span>"}),"<p>"+t.text+"</p>"}}(i);if($(".text").html(u),c&&I(),t=$(".text").offsetHeight(),e=$(".right").offsetHeight(),pageInfo.index){var f="-"+ +o*e+"px";$(".text").css("top",f)}if(a&&vl.play(),t>e)l=!0,$('<div class="btn"><div id="upBtn">上一页</div><div id="downBtn">下一页</div></div>').appendTo("body"),!o&&$("#upBtn").addClass("unactive"),o==Math.ceil(t/e)-1&&$("#downBtn").addClass("unactive");else{var v=parseInt($(".text p").css("height"));$(".text").css("top","50%"),$(".text p").css("marginTop","-"+v/2+"px")}d?x("#vod"):c&&x("#textUrl")},getIndex:function(){return{index:o,textIndex:i,textFocus:c}}}}());